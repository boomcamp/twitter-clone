<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Twitter</title>
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
      integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="styles/styles.css"
      type="text/css"
      media="screen"
      title="no title"
      charset="utf-8"
    />
  </head>
  <body>
    <main>
      <div class="compose">
        <img class="img-profile" src="img/damenleeturks.jpg" alt="" />
        <div class="input-container">
          <textarea
            placeholder="What's happening?"
            name="tweetText"
            id="composeInput"
            maxlength="280"
            data-testid="tweet-input"
          ></textarea>
          <div class="input-button" data-testid="input-button">
            <i class="fas fa-image"></i>
          </div>
          <div class="actions" data-testid="tweet-actions">
            <div class="action-buttons">
              <button class="icon-button">
                <i class="fas fa-image"></i>
              </button>
              <button class="icon-button">
                <i class="fas fa-file-video"></i>
              </button>
              <button class="icon-button">
                <i class="fas fa-chart-bar"></i>
              </button>
              <button class="icon-button">
                <i class="fas fa-map-marker-alt"></i>
              </button>
            </div>
            <div class="post-actions">
              <span class="message-count" data-testid="message-count">280</span>
              <button class="post-tweet" data-testid="post-tweet" disabled>Tweet</button>
            </div>
          </div>
        </div>
      </div>
      <div class="tweets" data-testid="tweets">
        <div class="tweet">
          <div class="profile">
            <img class="img-tweet-profile" src="img/funwatercat.jpg" />
          </div>
          <div class="message">
            <div class="posted-by">
              <span class="display-name">Michael</span
              ><span class="handle">@sometwitterguy</span>
            </div>
            <div class="content">
              <p>Today is an amazing day!</p>
            </div>
            <div class="tweet-actions">
              <i class="far fa-comment"></i>
              <i class="fas fa-retweet"></i>
              <i class="far fa-heart"></i>
              <i class="far fa-envelope"></i>
            </div>
          </div>
        </div>
      </div>
    </main>
    <script src="https://unpkg.com/jquery@3.4.1/dist/jquery.js"></script>
    <script>
      $(document).ready(function(){
        var maxlen = $('#composeInput').attr("maxlength");
        $('.actions').hide();
        $('#composeInput').blur(function(){
          if($(this).val() <= 0){
            $('.actions').hide();
            $('.input-button').show()
            $('#composeInput').removeClass("expanded");
          }
        });

        $('#composeInput').focus(function(){
          $('.actions').show()
          $('.input-button').hide();
          $(this).addClass("expanded");
          $(this).on('keypress input', function(){
            limits($(this));
            if($(this).val() !== ""){
              $('.post-tweet').attr('disabled', false);
            }else{
              $('.post-tweet').attr('disabled', true);
            }  
          });
          
        });
        function limits(e){
          if(e.val().length > maxlen){
            e.val(e.val().substring(0, maxlen));
          }else{
            var remaining = maxlen - e.val().length;
            $('.message-count').text(remaining);
            if(remaining < 11){
              $('.message-count').addClass("danger");
            }else{
              $('.message-count').removeClass("danger");
            }
          }
        }
        var date1 = new Date().getTime();
        $('.post-tweet').click(function(){
          var date2 = new Date().getTime();
          var time = Math.round(((date2 - date1)/1000).toString());
          if(time >= 86400){
            var sec = Math.round((((((date2 - date1)/1000)/600)/3600)/86400).toString())
            var newtime = time/86400 + "days ago"
          }
          if(time >= 3600){
            sec = Math.round(((((date2 - date1)/1000)/600)/3600).toString())
            newtime = time/3600 + "hrs ago"
          }else if(time >= 60){
            sec = Math.round((((date2 - date1)/1000)/600).toString())
            newtime = time/60 + "mins ago"
          }else if(time < 60){
            newtime = time + "seconds ago"
          }
          var element = $(`
          <div class='tweet'>
            <div class='profile'>
              <img class='img-tweet-profile' src='img/damenleeturks.jpg'/>
            </div>
            <div class='message'>
              <div class='posted-by'>
                <span class='display-name'>Franco</span>
                <span class='handle'>@anothertwitterguy</span>
                <span class='handle'>${newtime}</span>
              </div>
              <div class='content'>
                <p>${$("#composeInput").val()}</p>
              </div><div class='tweet-actions'>
                <i class='far fa-comment'></i>
                <i class='fas fa-retweet'></i>
                <i class='far fa-heart'></i>
                <i class='far fa-envelope'></i>
              </div>
            </div>
          </div>`);
          $('.tweets').prepend(element);
          $('#composeInput').val('');
          $('.actions').hide();
          $('#composeInput').removeClass("expanded");
          $('.message-count').text("280");
          $('.input-button').show();
        });
        
        // $(".fa-image").on("click", function(){
        //   $(".fa-image").attr("accept", "image/*")
        // })
      });
    </script>
  </body>
</html>
