<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Twitter</title>
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
      integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="styles/styles.css"
      type="text/css"
      media="screen"
      title="no title"
      charset="utf-8"
    />      
  </head>
  <body>
    <main>
      <div class="compose">
        <img class="img-profile" src="img/damenleeturks.jpg" alt="" />
        <div class="input-container">
          <textarea
            placeholder="What's happening?"
            name="tweetText"
            id="composeInput"
            maxlength="280"
            data-testid="tweet-input"
          ></textarea><input type="file" id="file-image">

          <div class="input-button" data-testid="input-button">
            <i class="fas fa-image"></i>
          </div>
          <div class="actions" data-testid="tweet-actions">
            <div class="action-buttons">
              <button class="icon-button">
                <i class="fas fa-image"></i>
              </button>
              <button class="icon-button">
                <i class="fas fa-file-video"></i>
              </button>
              <button class="icon-button">
                <i class="fas fa-chart-bar"></i>
              </button>
              <button class="icon-button">
                <i class="fas fa-map-marker-alt"></i>
              </button>
            </div>
            <div class="post-actions">
              <span class="message-count" data-testid="message-count">280</span>
              <button class="post-tweet" data-testid="post-tweet" disabled>Tweet</button>
            </div>
          </div>
        </div>
      </div>
      <div class="tweets" data-testid="tweets">
        <div class="tweet">
          <div class="profile">
            <img class="img-tweet-profile" src="img/funwatercat.jpg" />
          </div>
          <div class="message">
            <div class="posted-by">
              <span class="display-name">Michael</span
              ><span class="handle">@sometwitterguy</span>
            </div>
            <div class="content">
              <p>Today is an amazing day!</p>
            </div>
            <div class="tweet-actions">
              <i class="far fa-comment"></i>
              <i class="fas fa-retweet"></i>
              <i class="far fa-heart"></i>
              <i class="far fa-envelope"></i>
            </div>
          </div>
        </div>  
      </div>
      <p class="dark-text">DARK MODE: </p>
      <label class="switch">
   
        <input type="checkbox" class="darkmode">
        <span class="slider"></span>
      </label>  
    </main>
    <script src="https://unpkg.com/jquery@3.4.1/dist/jquery.js"></script>
    
    <script>
      $(document).ready(function(){
        let color="",tmppath='';
        $(".actions").hide();
        // var timeDiff = new Date().getHours() + new Date().getMinutes()
        // if(timeDiff - postedTime == 0){
        //   $('.tweet-actions').prepend(`<i style="float: right; color: gray;">a moment ago</i>`);
        // }

        $("#composeInput").blur(function(){
          if(this.value.length == 0){
            $(".actions").hide();
            $(".input-button").show();
            $("#composeInput").removeClass("expanded");
          }
        })
    
        $("#composeInput").on('focus keyup',function(){
          $(".actions").show();
          $(".input-button").hide();
          $("#composeInput").addClass("expanded");
       
          // let max = 280;
          let max = $("#composeInput").attr('maxlength');
          max -= this.value.length;
          $('.message-count').text(max)
          
          if(max <= 10)
            $('.message-count').addClass('danger');
          else
            $('.message-count').removeClass('danger');

          if(this.value == "")   
            $(".post-tweet").attr("disabled", true);
          else
            $(".post-tweet").attr("disabled", false);
        })


        $('#file-image').change( function(event) {
          $(".actions").show();
          $(".input-button").hide();
          $("#composeInput").addClass("expanded");
          tmppath = URL.createObjectURL(event.target.files[0]);
        });

        $(".post-tweet").click(function(){
          // const postedTime = date.getHours()+date.getMinutes()

          $(".tweets").prepend(`
          <div class="tweet ${color}">
            <div class="profile">
              <img class="img-tweet-profile" src="img/damenleeturks.jpg" />
            </div>
            
            <div class="message">
              <div class="posted-by">
                <span class="display-name">Jeff</span>
                <span class="handle">@jeffguy</span>
              </div>
              
              <div class="content">
                <p>${$("#composeInput").val()}</p>
              </div>

              <img src="" id="image" width="300" height="250" class="image-post"/>

              <div class="tweet-actions">

                <i class="far fa-comment"></i>
                <i class="fas fa-retweet"></i>
                <i class="far fa-heart"></i>
                <i class="far fa-envelope"></i>
              </div>
            </div>
          </div>`);
          // <img src="" id="image" width="300" height="250"/>
          // $('#image').attr('src',URL.createObjectURL($('#image-file').files[0]));

          // console.log(tmppath)
          
          if($("#file-image").val()){
            $("#image").css('display', 'block');
            $("#image").fadeIn("fast").attr('src',tmppath);
            $("#file-image").val('') 
          }

          $(".actions").hide();
          $(".input-button").show();
          $("#composeInput").removeClass("expanded").val('');
          $('.message-count').text('280')
          $(".post-tweet").prop("disabled", true);
        });

        $(".darkmode").change(function(){
          if($('.darkmode').is(":checked")){
            $('.compose').addClass("dark-mode-color-header")
            $('.tweet').addClass("dark_mode_color_tweets")
            color = "dark_mode_color_tweets";
          }
          else{
            $('.compose').removeClass("dark-mode-color-header")
            $('.tweet').removeClass("dark_mode_color_tweets")
            color = "";
          }
        });

      });
    </script>
  
  </body>
</html>
