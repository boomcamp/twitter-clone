<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Twitter</title>
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
      integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="styles/styles.css"
      type="text/css"
      media="screen"
      title="no title"
      charset="utf-8"
    />      
  </head>
  <body>
    <main>
      <div class="compose">
        <img class="img-profile" src="img/damenleeturks.jpg" alt="" />
        <div class="input-container">
          
          <textarea
            placeholder="What's happening?"
            name="tweetText"
            id="composeInput"
            maxlength="280"
            data-testid="tweet-input"
					></textarea>
					<a class="close-img">&times;</a>
					<img src="" id="preview_img" width="300" height="250" alt="">
					<input type="file" id="file-image">

          <div class="input-button" data-testid="input-button">
            <i class="fas fa-image"></i>
          </div>
          <div class="actions" data-testid="tweet-actions">
            <div class="action-buttons">
              <button class="icon-button">
                <i class="fas fa-image" ></i>
              </button>
              <button class="icon-button">
                <i class="fas fa-file-video"></i>
              </button>
              <button class="icon-button">
                <i class="fas fa-chart-bar"></i>
              </button>
              <button class="icon-button">
                <i class="fas fa-map-marker-alt"></i>
              </button>
            </div>
            <div class="post-actions">
              <span class="message-count" data-testid="message-count">280</span>
              <button class="post-tweet" data-testid="post-tweet" disabled>Tweet</button>
            </div>
          </div>
        </div>
      </div>
      <div class="tweets" data-testid="tweets">
        <div class="tweet">
          <div class="profile">
            <img class="img-tweet-profile" src="img/funwatercat.jpg" />
          </div>
          <div class="message">
            <div class="posted-by">
              <span class="display-name">Michael</span
              ><span class="handle">@sometwitterguy</span>
            </div>
            <div class="content">
              <p>Today is an amazing day!</p>
            </div>
            <div class="tweet-actions">
              <i class="far fa-comment"></i>
              <i class="fas fa-retweet"></i>
              <i class="far fa-heart"></i>
              <i class="far fa-envelope"></i>
            </div>
          </div>
        </div>  
      </div>
      <p class="dark-text">DARK MODE: </p>
      <label class="switch">
   
        <input type="checkbox" class="darkmode">
        <span class="slider"></span>
      </label>  
    </main>
    <script src="https://unpkg.com/jquery@3.4.1/dist/jquery.js"></script>
    
    <script>
      $(document).ready(function(){
        let color="",tmppath='',postedTime_min=0;
        $(".actions").hide();

        // var timeDiff = new Date().getHours() + new Date().getMinutes()
        // if(timeDiff - postedTime == 60){
        //   $('.time').text("a minute ago");
        // }
				
				function hideTextarea(){
					$(".actions").hide();
          $(".input-button").show();
          $("#composeInput").removeClass("expanded").val('');
				}

				function showTextarea(){
					$(".actions").show();
          $(".input-button").hide();
          $("#composeInput").addClass("expanded");
				}

        // ---------------------- TWEET INPUT ---------------------- //
        $("#composeInput").blur(function(){
          if($(".fa-image").data("clicked")){
						$(".fa-image").data("clicked", false)
					}
					else if(this.value.length == 0 && $("#preview_img").attr("src") == "")
            hideTextarea();
        })
    
        $("#composeInput").on('focus keyup',function(){
					showTextarea();
       
          // let max = 280;
          let max = $("#composeInput").attr('maxlength');
          max -= this.value.length;
          $('.message-count').text(max)
          
          if(max <= 10)
            $('.message-count').addClass('danger');
          else
            $('.message-count').removeClass('danger');

          if(this.value != "" || $("#preview_img").attr("src") != "")
            $(".post-tweet").attr("disabled", false);
          else
            $(".post-tweet").attr("disabled", true);
        })

        // ---------------------- ADD IMAGE ---------------------- //
        $('.fa-image').mousedown(function(){
          showTextarea();
          $("#file-image").trigger("click");
					$(".fa-image").data("clicked", true);
        })

        $('#file-image').change(function(event) {
          tmppath = URL.createObjectURL(event.target.files[0]);
          $("#preview_img").css('display', 'block').attr('src', tmppath);
					$(".close-img").css('display', 'block');

          if($("#preview_img").attr("src") != "")
            $(".post-tweet").attr("disabled", false);
        });

				$('.close-img').click(function(){
					$("#file-image").val('');
					$("#preview_img").attr('src', '').css('display', 'none');
					$(".close-img").css('display', 'none');
					
					if($("#composeInput").val() == "")
						$(".post-tweet").attr("disabled", true);
				});

        // ---------------------- SUBMIT TWEET ---------------------- //
        $(".post-tweet").click(function(){
          // var postedTime  = new Date().getHours() + new Date().getMinutes()

          $(".tweets").prepend(`
          <div class="tweet ${color}">
            <div class="profile">
              <img class="img-tweet-profile" src="img/damenleeturks.jpg" />
            </div>
            
            <div class="message">
              <div class="posted-by">
                <span class="display-name">Jeff</span>
                <span class="handle">@jeffguy</span>
                <span class="time">a seconds ago</span>
              </div>
              
              <div class="content">
                <p>${$("#composeInput").val()}</p>
              </div>

              <img src="" id="image" width="300" height="250" class="image-post"/>

              <div class="tweet-actions">

                <i class="far fa-comment"></i>
                <i class="fas fa-retweet"></i>
                <i class="far fa-heart"></i>
                <i class="far fa-envelope"></i>
              </div>
            </div>
          </div>`);
          
          if($("#file-image").val()){
            $("#image").css('display', 'block').fadeIn("fast").attr('src',tmppath);
            $("#file-image").val('') 
            $("#preview_img").attr('src', '').css('display', 'none');
						$(".close-img").css('display', 'none') 
          }

          hideTextarea();
          $('.message-count').text('280')
          $(".post-tweet").prop("disabled", true);

					// ---------------------- TIMESTAMP ---------------------- //
					count_min();
					function count_min(){
						setTimeout(function(){
							timeStamp();
						}, 60000)
					}

					function timeStamp(){
						if(postedTime_min <= 59){
							postedTime_min += 1;
							$(".time").text(`${postedTime_min}min ago`);
							count_min();
						}
						else if(postedTime_min >= 60 && postedTime_min < 1440){
							postedTime_min += 1;
							postedTime_min = Math.floor(postedTime_min/60);
							$(".time").text(`${postedTime_min}hr ago`)
							count_min();
						}
						else if(postedTime_min <= 1440){
							postedTime_min += 1;
							postedTime_min = Math.floor(postedTime_min/1440);
							$(".time").text(`${postedTime_min}day ago`)
							count_min();
						}
					}
        });


        // ---------------------- DARK MODE ---------------------- //
        $(".darkmode").change(function(){
          if($('.darkmode').is(":checked")){
            $('.compose').addClass("dark-mode-color-header")
            $('.tweet').addClass("dark_mode_color_tweets")
            color = "dark_mode_color_tweets";
          }
          else{
            $('.compose').removeClass("dark-mode-color-header")
            $('.tweet').removeClass("dark_mode_color_tweets")
            color = "";
          }
        });
      });
    </script>
  
  </body>
</html>
